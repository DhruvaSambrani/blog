<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang xml:lang><meta charset=utf-8><meta name=generator content="pandoc"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=author content="Dhruva Sambrani"><meta name=keywords content="mysetup minimalism mycreation ai"><title>Jumping into the <code>river</code> and AI | Dhruva's Blog</title><link rel=stylesheet href=/blog/assets/css/pandoc-styles.css><link rel=stylesheet href=/blog/assets/css/styles.css><div class=markdown-body><h1 id=jumping-into-the-river-and-ai>Jumping into the <code>river</code> and AI</h1><p>I <a href=2023-11-12_003358>used</a> <code>dwl</code> until <a href=https://codeberg.org/dwl/dwl/issues/1166>dwl was stated as stagnant</a>. I tried hyprland, but it was not clear to me how to add custom layouts, and I like my grid based layout from dwl. Also i would have to set up a new bar, and would have to work with their way of showing things, which i felt was way too much effort. I wanted the flexibility of dwl. There is also a maximalist fork of dwl called <a href=https://github.com/DreamMaoMao/mangowc>mangowc</a>, but I would have to either accept the maximalist view of it or maintain a stripped down fork of that, which seemed convoluted. niri was not tiled, and I don’t think I would like the scrolling layout.<h2 id=migrating-to-river>Migrating to river</h2><h3 id=layouts>Layouts</h3><p><a href=https://codeberg.org/river/river>riverwc</a> was what I finally settled on. The main advantage that I saw was that its structured the same way as dwl, with rule based layouting. The custom layout protocol was great, especially <a href=https://github.com/MaxVerevkin/river-luatile>river-luatile</a> which allows you to write the layouts in lua. After some off by one errors I had implemented a gaplessgrid and monocle layout, and used the default <code>master</code> layout from river-luatile. I setup keybinds to change between them: I really love that you can call any lua command from the keybinds, which made the layout changing so easy.<div class=sourceCode id=cb1><pre class="sourceCode lua"><code class="sourceCode lua"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=co>#! /usr/bin/lua</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true tabindex=-1></a><span class=co>-- You can define your global state here</span></span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true tabindex=-1></a><span class=kw>local</span> <span class=va>agaps</span> <span class=op>=</span> <span class=dv>4</span></span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true tabindex=-1></a><span class=kw>local</span> <span class=va>master_ratio</span> <span class=op>=</span> <span class=dv>0.55</span></span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true tabindex=-1></a><span class=kw>function</span> iswidescreen<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> <span class=va>args</span><span class=op>.</span><span class=va>width</span> <span class=op>&gt;</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span></span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true tabindex=-1></a><span class=kw>function</span> master<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>retval</span> <span class=op>=</span> <span class=op>{}</span></span>
<span id=cb1-13><a href=#cb1-13 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>gaps</span> <span class=op>=</span> <span class=va>agaps</span></span>
<span id=cb1-14><a href=#cb1-14 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>==</span> <span class=dv>1</span> <span class=cf>then</span></span>
<span id=cb1-15><a href=#cb1-15 aria-hidden=true tabindex=-1></a>        <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span> <span class=dv>0</span><span class=op>,</span> <span class=dv>0</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>width</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>})</span></span>
<span id=cb1-16><a href=#cb1-16 aria-hidden=true tabindex=-1></a>    <span class=cf>elseif</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>&gt;</span> <span class=dv>1</span> <span class=cf>then</span></span>
<span id=cb1-17><a href=#cb1-17 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>main_w</span> <span class=op>=</span> <span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>width</span> <span class=op>-</span> <span class=va>gaps</span> <span class=op>*</span> <span class=dv>3</span><span class=op>)</span> <span class=op>*</span> <span class=va>master_ratio</span></span>
<span id=cb1-18><a href=#cb1-18 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>side_w</span> <span class=op>=</span> <span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>width</span> <span class=op>-</span> <span class=va>gaps</span> <span class=op>*</span> <span class=dv>3</span><span class=op>)</span> <span class=op>-</span> <span class=va>main_w</span></span>
<span id=cb1-19><a href=#cb1-19 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>main_h</span> <span class=op>=</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>-</span> <span class=va>gaps</span> <span class=op>*</span> <span class=dv>2</span></span>
<span id=cb1-20><a href=#cb1-20 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>side_h</span> <span class=op>=</span> <span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>-</span> <span class=va>gaps</span><span class=op>)</span> <span class=op>/</span> <span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>-</span> <span class=dv>1</span><span class=op>)</span> <span class=op>-</span> <span class=va>gaps</span></span>
<span id=cb1-21><a href=#cb1-21 aria-hidden=true tabindex=-1></a>        <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span></span>
<span id=cb1-22><a href=#cb1-22 aria-hidden=true tabindex=-1></a>            <span class=va>gaps</span><span class=op>,</span></span>
<span id=cb1-23><a href=#cb1-23 aria-hidden=true tabindex=-1></a>            <span class=va>gaps</span><span class=op>,</span></span>
<span id=cb1-24><a href=#cb1-24 aria-hidden=true tabindex=-1></a>            <span class=va>main_w</span><span class=op>,</span></span>
<span id=cb1-25><a href=#cb1-25 aria-hidden=true tabindex=-1></a>            <span class=va>main_h</span><span class=op>,</span></span>
<span id=cb1-26><a href=#cb1-26 aria-hidden=true tabindex=-1></a>        <span class=op>})</span></span>
<span id=cb1-27><a href=#cb1-27 aria-hidden=true tabindex=-1></a>        <span class=cf>for</span> <span class=va>i</span> <span class=op>=</span> <span class=dv>0</span><span class=op>,</span> <span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>-</span> <span class=dv>2</span><span class=op>)</span> <span class=cf>do</span></span>
<span id=cb1-28><a href=#cb1-28 aria-hidden=true tabindex=-1></a>            <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span></span>
<span id=cb1-29><a href=#cb1-29 aria-hidden=true tabindex=-1></a>                <span class=va>main_w</span> <span class=op>+</span> <span class=va>gaps</span> <span class=op>*</span> <span class=dv>2</span><span class=op>,</span></span>
<span id=cb1-30><a href=#cb1-30 aria-hidden=true tabindex=-1></a>                <span class=va>gaps</span> <span class=op>+</span> <span class=va>i</span> <span class=op>*</span> <span class=op>(</span><span class=va>side_h</span> <span class=op>+</span> <span class=va>gaps</span><span class=op>),</span></span>
<span id=cb1-31><a href=#cb1-31 aria-hidden=true tabindex=-1></a>                <span class=va>side_w</span><span class=op>,</span></span>
<span id=cb1-32><a href=#cb1-32 aria-hidden=true tabindex=-1></a>                <span class=va>side_h</span><span class=op>,</span></span>
<span id=cb1-33><a href=#cb1-33 aria-hidden=true tabindex=-1></a>            <span class=op>})</span></span>
<span id=cb1-34><a href=#cb1-34 aria-hidden=true tabindex=-1></a>        <span class=cf>end</span></span>
<span id=cb1-35><a href=#cb1-35 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-36><a href=#cb1-36 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> <span class=va>retval</span></span>
<span id=cb1-37><a href=#cb1-37 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-38><a href=#cb1-38 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-39><a href=#cb1-39 aria-hidden=true tabindex=-1></a><span class=kw>function</span> grid<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-40><a href=#cb1-40 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>gaps</span> <span class=op>=</span> <span class=va>agaps</span></span>
<span id=cb1-41><a href=#cb1-41 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>==</span> <span class=dv>1</span> <span class=cf>then</span></span>
<span id=cb1-42><a href=#cb1-42 aria-hidden=true tabindex=-1></a>        <span class=va>gaps</span> <span class=op>=</span> <span class=dv>0</span></span>
<span id=cb1-43><a href=#cb1-43 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-44><a href=#cb1-44 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>retval</span> <span class=op>=</span> <span class=op>{}</span></span>
<span id=cb1-45><a href=#cb1-45 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>ncols</span> <span class=op>=</span> <span class=dv>1</span></span>
<span id=cb1-46><a href=#cb1-46 aria-hidden=true tabindex=-1></a>    <span class=cf>while</span> <span class=va>ncols</span> <span class=op>*</span> <span class=va>ncols</span> <span class=op>&lt;</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=cf>do</span></span>
<span id=cb1-47><a href=#cb1-47 aria-hidden=true tabindex=-1></a>        <span class=va>ncols</span> <span class=op>=</span> <span class=va>ncols</span> <span class=op>+</span> <span class=dv>1</span></span>
<span id=cb1-48><a href=#cb1-48 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-49><a href=#cb1-49 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> iswidescreen<span class=op>(</span><span class=va>args</span><span class=op>)</span> <span class=kw>and</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>==</span> <span class=dv>3</span> <span class=cf>then</span></span>
<span id=cb1-50><a href=#cb1-50 aria-hidden=true tabindex=-1></a>        <span class=va>ncols</span> <span class=op>=</span> <span class=dv>3</span> <span class=co>-- 1:1:1</span></span>
<span id=cb1-51><a href=#cb1-51 aria-hidden=true tabindex=-1></a>    <span class=cf>elseif</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>==</span> <span class=dv>5</span> <span class=cf>then</span></span>
<span id=cb1-52><a href=#cb1-52 aria-hidden=true tabindex=-1></a>        <span class=va>ncols</span> <span class=op>=</span> <span class=dv>2</span></span>
<span id=cb1-53><a href=#cb1-53 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-54><a href=#cb1-54 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>nrows</span> <span class=op>=</span> <span class=fu>math.ceil</span><span class=op>(</span><span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>/</span> <span class=va>ncols</span><span class=op>)</span></span>
<span id=cb1-55><a href=#cb1-55 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>cw</span> <span class=op>=</span> <span class=va>args</span><span class=op>.</span><span class=va>width</span> <span class=op>/</span> <span class=va>ncols</span></span>
<span id=cb1-56><a href=#cb1-56 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>ch</span> <span class=op>=</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>/</span> <span class=va>nrows</span></span>
<span id=cb1-57><a href=#cb1-57 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>fcnrows</span> <span class=op>=</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>-</span> <span class=op>(</span><span class=va>nrows</span> <span class=op>*</span> <span class=op>(</span><span class=va>ncols</span> <span class=op>-</span> <span class=dv>1</span><span class=op>))</span></span>
<span id=cb1-58><a href=#cb1-58 aria-hidden=true tabindex=-1></a>    <span class=cf>for</span> <span class=va>row</span> <span class=op>=</span> <span class=dv>0</span><span class=op>,</span> <span class=va>fcnrows</span> <span class=op>-</span> <span class=dv>1</span> <span class=cf>do</span></span>
<span id=cb1-59><a href=#cb1-59 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>fcch</span> <span class=op>=</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>/</span> <span class=va>fcnrows</span></span>
<span id=cb1-60><a href=#cb1-60 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>x</span> <span class=op>=</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span></span>
<span id=cb1-61><a href=#cb1-61 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>y</span> <span class=op>=</span> <span class=va>row</span> <span class=op>*</span> <span class=va>fcch</span> <span class=op>+</span> <span class=op>((</span><span class=va>row</span> <span class=op>==</span> <span class=dv>0</span><span class=op>)</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span></span>
<span id=cb1-62><a href=#cb1-62 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>w</span> <span class=op>=</span> <span class=va>cw</span> <span class=op>-</span> <span class=dv>3</span> <span class=op>*</span> <span class=va>gaps</span></span>
<span id=cb1-63><a href=#cb1-63 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>h</span> <span class=op>=</span> <span class=va>fcch</span> <span class=op>-</span> <span class=op>(</span><span class=va>row</span> <span class=op>==</span> <span class=dv>0</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span> <span class=op>-</span> <span class=op>((</span><span class=va>row</span> <span class=op>==</span> <span class=va>fcnrows</span> <span class=op>-</span> <span class=dv>1</span><span class=op>)</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span></span>
<span id=cb1-64><a href=#cb1-64 aria-hidden=true tabindex=-1></a>        <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span> <span class=va>x</span><span class=op>,</span> <span class=va>y</span><span class=op>,</span> <span class=va>w</span><span class=op>,</span> <span class=va>h</span> <span class=op>})</span></span>
<span id=cb1-65><a href=#cb1-65 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-66><a href=#cb1-66 aria-hidden=true tabindex=-1></a>    <span class=cf>for</span> <span class=va>i</span> <span class=op>=</span> <span class=va>fcnrows</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>-</span> <span class=dv>1</span> <span class=cf>do</span></span>
<span id=cb1-67><a href=#cb1-67 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>cellid</span> <span class=op>=</span> <span class=op>(</span><span class=va>i</span> <span class=op>-</span> <span class=va>fcnrows</span><span class=op>)</span> <span class=op>+</span> <span class=va>nrows</span></span>
<span id=cb1-68><a href=#cb1-68 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>row</span> <span class=op>=</span> <span class=op>(</span><span class=va>cellid</span> <span class=op>+</span> <span class=va>fcnrows</span><span class=op>)</span> <span class=op>%</span> <span class=va>nrows</span></span>
<span id=cb1-69><a href=#cb1-69 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>col</span> <span class=op>=</span> <span class=fu>math.floor</span><span class=op>(</span><span class=va>cellid</span> <span class=op>/</span> <span class=va>nrows</span><span class=op>)</span></span>
<span id=cb1-70><a href=#cb1-70 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>x</span> <span class=op>=</span> <span class=va>col</span> <span class=op>*</span> <span class=va>cw</span> <span class=op>+</span> <span class=va>gaps</span></span>
<span id=cb1-71><a href=#cb1-71 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>y</span> <span class=op>=</span> <span class=va>row</span> <span class=op>*</span> <span class=va>ch</span> <span class=op>+</span> <span class=op>((</span><span class=va>row</span> <span class=op>==</span> <span class=dv>0</span><span class=op>)</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span></span>
<span id=cb1-72><a href=#cb1-72 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>w</span> <span class=op>=</span> <span class=va>cw</span> <span class=op>-</span> <span class=op>((</span><span class=va>col</span> <span class=op>==</span> <span class=va>ncols</span><span class=op>)</span> <span class=kw>and</span> <span class=dv>3</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span><span class=op>)</span></span>
<span id=cb1-73><a href=#cb1-73 aria-hidden=true tabindex=-1></a>        <span class=kw>local</span> <span class=va>h</span> <span class=op>=</span> <span class=va>ch</span> <span class=op>-</span> <span class=op>(</span><span class=va>row</span> <span class=op>==</span> <span class=dv>0</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span> <span class=op>-</span> <span class=op>((</span><span class=va>row</span> <span class=op>==</span> <span class=va>fcnrows</span> <span class=op>-</span> <span class=dv>1</span><span class=op>)</span> <span class=kw>and</span> <span class=dv>2</span> <span class=op>*</span> <span class=va>gaps</span> <span class=kw>or</span> <span class=va>gaps</span><span class=op>)</span></span>
<span id=cb1-74><a href=#cb1-74 aria-hidden=true tabindex=-1></a>        <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span> <span class=va>x</span><span class=op>,</span> <span class=va>y</span><span class=op>,</span> <span class=va>w</span><span class=op>,</span> <span class=va>h</span> <span class=op>})</span></span>
<span id=cb1-75><a href=#cb1-75 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-76><a href=#cb1-76 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> <span class=va>retval</span></span>
<span id=cb1-77><a href=#cb1-77 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-78><a href=#cb1-78 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-79><a href=#cb1-79 aria-hidden=true tabindex=-1></a><span class=kw>function</span> monocle<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-80><a href=#cb1-80 aria-hidden=true tabindex=-1></a>    <span class=kw>local</span> <span class=va>retval</span> <span class=op>=</span> <span class=op>{}</span></span>
<span id=cb1-81><a href=#cb1-81 aria-hidden=true tabindex=-1></a>    <span class=cf>for</span> <span class=cn>_</span> <span class=op>=</span> <span class=dv>0</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>count</span> <span class=op>-</span> <span class=dv>1</span> <span class=cf>do</span></span>
<span id=cb1-82><a href=#cb1-82 aria-hidden=true tabindex=-1></a>        <span class=fu>table.insert</span><span class=op>(</span><span class=va>retval</span><span class=op>,</span> <span class=op>{</span> <span class=dv>0</span><span class=op>,</span> <span class=dv>0</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>width</span><span class=op>,</span> <span class=va>args</span><span class=op>.</span><span class=va>height</span> <span class=op>})</span></span>
<span id=cb1-83><a href=#cb1-83 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-84><a href=#cb1-84 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> <span class=va>retval</span></span>
<span id=cb1-85><a href=#cb1-85 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-86><a href=#cb1-86 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-87><a href=#cb1-87 aria-hidden=true tabindex=-1></a><span class=co>-- The most important function - the actual layout generator</span></span>
<span id=cb1-88><a href=#cb1-88 aria-hidden=true tabindex=-1></a><span class=co>--</span></span>
<span id=cb1-89><a href=#cb1-89 aria-hidden=true tabindex=-1></a><span class=co>-- The argument is a table with:</span></span>
<span id=cb1-90><a href=#cb1-90 aria-hidden=true tabindex=-1></a><span class=co>--  * Focused tags (`args.tags`)</span></span>
<span id=cb1-91><a href=#cb1-91 aria-hidden=true tabindex=-1></a><span class=co>--  * Window count (`args.count`)</span></span>
<span id=cb1-92><a href=#cb1-92 aria-hidden=true tabindex=-1></a><span class=co>--  * Output width (`args.width`)</span></span>
<span id=cb1-93><a href=#cb1-93 aria-hidden=true tabindex=-1></a><span class=co>--  * Output height (`args.height`)</span></span>
<span id=cb1-94><a href=#cb1-94 aria-hidden=true tabindex=-1></a><span class=co>--  * Output name (`args.output`)</span></span>
<span id=cb1-95><a href=#cb1-95 aria-hidden=true tabindex=-1></a><span class=co>--</span></span>
<span id=cb1-96><a href=#cb1-96 aria-hidden=true tabindex=-1></a><span class=co>-- The return value must be a table with exactly `count` entries. Each entry is a table with four</span></span>
<span id=cb1-97><a href=#cb1-97 aria-hidden=true tabindex=-1></a><span class=co>-- numbers:</span></span>
<span id=cb1-98><a href=#cb1-98 aria-hidden=true tabindex=-1></a><span class=co>--  * X coordinate</span></span>
<span id=cb1-99><a href=#cb1-99 aria-hidden=true tabindex=-1></a><span class=co>--  * Y coordinate</span></span>
<span id=cb1-100><a href=#cb1-100 aria-hidden=true tabindex=-1></a><span class=co>--  * Window width</span></span>
<span id=cb1-101><a href=#cb1-101 aria-hidden=true tabindex=-1></a><span class=co>--  * Window height</span></span>
<span id=cb1-102><a href=#cb1-102 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-103><a href=#cb1-103 aria-hidden=true tabindex=-1></a><span class=kw>local</span> <span class=va>active_layout</span> <span class=op>=</span> <span class=va>grid</span></span>
<span id=cb1-104><a href=#cb1-104 aria-hidden=true tabindex=-1></a><span class=kw>function</span> handle_layout<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-105><a href=#cb1-105 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> active_layout<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-106><a href=#cb1-106 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-107><a href=#cb1-107 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-108><a href=#cb1-108 aria-hidden=true tabindex=-1></a><span class=co>-- This optional function returns the metadata for the current layout.</span></span>
<span id=cb1-109><a href=#cb1-109 aria-hidden=true tabindex=-1></a><span class=co>-- Currently only `name` is supported, the name of the layout. It get&#39;s passed</span></span>
<span id=cb1-110><a href=#cb1-110 aria-hidden=true tabindex=-1></a><span class=co>-- the same `args` as handle_layout()</span></span>
<span id=cb1-111><a href=#cb1-111 aria-hidden=true tabindex=-1></a><span class=kw>function</span> handle_metadata<span class=op>(</span><span class=va>args</span><span class=op>)</span></span>
<span id=cb1-112><a href=#cb1-112 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=va>active_layout</span> <span class=op>==</span> <span class=va>grid</span> <span class=cf>then</span></span>
<span id=cb1-113><a href=#cb1-113 aria-hidden=true tabindex=-1></a>        <span class=cf>return</span> <span class=op>{</span> <span class=va>name</span> <span class=op>=</span> <span class=st>&quot;#&quot;</span> <span class=op>}</span></span>
<span id=cb1-114><a href=#cb1-114 aria-hidden=true tabindex=-1></a>    <span class=cf>elseif</span> <span class=va>active_layout</span> <span class=op>==</span> <span class=va>master</span> <span class=cf>then</span></span>
<span id=cb1-115><a href=#cb1-115 aria-hidden=true tabindex=-1></a>        <span class=cf>return</span> <span class=op>{</span> <span class=va>name</span> <span class=op>=</span> <span class=st>&quot;T&quot;</span> <span class=op>}</span></span>
<span id=cb1-116><a href=#cb1-116 aria-hidden=true tabindex=-1></a>    <span class=cf>elseif</span> <span class=va>active_layout</span> <span class=op>==</span> <span class=va>monocle</span> <span class=cf>then</span></span>
<span id=cb1-117><a href=#cb1-117 aria-hidden=true tabindex=-1></a>        <span class=cf>return</span> <span class=op>{</span> <span class=va>name</span> <span class=op>=</span> <span class=st>&quot;M&quot;</span> <span class=op>}</span></span>
<span id=cb1-118><a href=#cb1-118 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-119><a href=#cb1-119 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-120><a href=#cb1-120 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-121><a href=#cb1-121 aria-hidden=true tabindex=-1></a><span class=kw>function</span> set_layout<span class=op>(</span><span class=va>arg</span><span class=op>)</span></span>
<span id=cb1-122><a href=#cb1-122 aria-hidden=true tabindex=-1></a>    <span class=va>active_layout</span> <span class=op>=</span> <span class=va>arg</span></span>
<span id=cb1-123><a href=#cb1-123 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-124><a href=#cb1-124 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-125><a href=#cb1-125 aria-hidden=true tabindex=-1></a><span class=kw>function</span> incmr<span class=op>()</span></span>
<span id=cb1-126><a href=#cb1-126 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=va>master_ratio</span> <span class=op>&lt;</span> <span class=dv>0.9</span> <span class=cf>then</span></span>
<span id=cb1-127><a href=#cb1-127 aria-hidden=true tabindex=-1></a>        <span class=va>master_ratio</span> <span class=op>=</span> <span class=va>master_ratio</span> <span class=op>+</span> <span class=dv>0.05</span></span>
<span id=cb1-128><a href=#cb1-128 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-129><a href=#cb1-129 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span>
<span id=cb1-130><a href=#cb1-130 aria-hidden=true tabindex=-1></a><span class=kw>function</span> decmr<span class=op>()</span></span>
<span id=cb1-131><a href=#cb1-131 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=va>master_ratio</span> <span class=op>&gt;</span> <span class=dv>0.1</span> <span class=cf>then</span></span>
<span id=cb1-132><a href=#cb1-132 aria-hidden=true tabindex=-1></a>        <span class=va>master_ratio</span> <span class=op>=</span> <span class=va>master_ratio</span> <span class=op>-</span> <span class=dv>0.05</span></span>
<span id=cb1-133><a href=#cb1-133 aria-hidden=true tabindex=-1></a>    <span class=cf>end</span></span>
<span id=cb1-134><a href=#cb1-134 aria-hidden=true tabindex=-1></a><span class=kw>end</span></span></code></pre></div><h3 id=migrating-config.h>Migrating config.h</h3><p>Migrating from dwl’s config.h to river’s init file was pretty easy, especially with the help of some regex replacements. Since river’s init can be written in anything, I just used bash scripts. I just had to remember to quote <code>*</code> and stuff, and it was seriously simpler than the <code>c</code> macros I was using in dwl.<h3 id=migrating-from-dwlb-to-sandbar>Migrating from dwlb to sandbar</h3><p>I was using the <a href=https://github.com/vetu104/dwlb>systray fork</a> of <a href=https://github.com/kolunmi/dwlb>dwlb</a> as my bar in dwl, which depended on the ipc patch. I was dreading having to set up a new bar system which also had a systray. It looked like waybar was the only one, but I would have to learn how to configure it. Then I saw <a href=https://github.com/kolunmi/sandbar>sandbar</a> which looked exactly like dwlb! I was pleasantly surprised by the similarities until I saw that they were both written by the same person, kolunmi! I realised that the systray and “bar without tags” patches were pretty easily transferable to sandbar, with only one major issue: dwlb used a socket based communication, whereas sandbar uses a pipe based communication. Since the systray requires the height of the rendered bar, it technically had to be a child process of sandbar. But since the width of systray would change, the communication had to happen from the child to parent. This meant piping the stdout of systray back into stdin of sandbar, reminiscent of the human caterpillar. Since this would prevent my status program from communicating sandbar, I used aistudio to tell me how to create another <code>fd</code> in sandbar and pipe it to that instead. Learnt a good deal about pipes I guess.<p>But river still did not have two features that I used a lot in dwl: <code>swallow</code> and <code>dim-unfocused</code>.<h2 id=patching-river-and-llms>Patching river, and LLMs</h2><p>I tried to use river without these features for a week or so. <code>dim-unfocused</code> was something I missed but could live without. The lack of <code>swallow</code> on the other hand was annoying. I searched if someone had already implemented it or if there was interest in this. There certainly was! But as people in <a href=https://codeberg.org/river/river/issues/73>this issue</a> rightly pointed out, any implementation would be quite hacky. This was fine in the “patch and maintain it yourself” ideology of dwl, but not for the centrally maintained “install and run” ideology of river.
But nothing stopped me from patching it for my own personal use. Except that river is a pretty complex application, and written in zig, which I don’t know. As is the trend these days I used aistudio to help me.<p>Just asking it to implement swallow led to abysmal results, obviously. What I’ve learnt is to instead tell it to not make any assumptions, and instead ask me for information. It took a little coaxing, but with an initial tree of files, finally aistudio was able to ask accurately for the contents of the files it asked me to edit, and gave much better results.<p>It did get stuck on how it assumed a particular <code>c</code> call (<code>wl_client_get_credentials</code>) would be ported to zig, and kept suggesting different variations to try, until I looked for the source code of the library and asked it which file contents it would like to look at. Once I gave it the contents though, it was able to accurately implement the call. There was a similar issue with a file read (I imagine it has not seen a lot of zig code, since I assumed this would be elementary), but again manually providing it with the docs helped it correctly implement it.<p>And with this, <code>swallow</code> was implemented with just one bug. When I tried to <code>unswallow</code>, it crashed. When I informed aistudio of the error, it guessed an invalid null pointer exception. I again cautioned it against guessing and provided a backtrace. With this it accurately caught that the unswallow code was being run too late, after the child client was already in a half-<code>destroy</code>ed state. Fixing this and some documentation and code completion changes, we were done.<p>With the harder swallow patch done, I started a new chat with a prompt that looked like<pre><code>&gt;tree of river source

This is the structure of river window manager. In the following requests, do not make any guesses, instead ask for information. Provide concise answers. Do not add text about feeling sorry from my frustration if something doesn&#39;t work. If we hit a snag, we will look for information, not make guesses.

I want to implement a dimming method which dims unfocussed windows. I already have an implementation for dwl. This is only a starting point, if you have a better idea, we will use that.

&gt;my dim-unfocused patch from dwl</code></pre><p>This resulted in far better results and the changes were very smooth, and stepwise.<h2 id=conclusion>Conclusion</h2><p>I think this LLM business is pretty useful if you yourself know how to do it. Its a very good tool, but its just that, a tool, still. So I guess the conclusion of this post is our jobs are still somewhat kinda safe? In any case, I now have a system that will hopefully last for a year, before river 0.3.x gets dropped in favor of <code>rwm</code>, and I’ll have to migrate all over again.</div><div class="markdown-body tags"><a href="/blog/tags.html#mysetup minimalism mycreation ai">#mysetup minimalism mycreation ai<a></div><footer><a class=footer-button id=home href=/blog/tags.html>Tags</a>
<img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png>
<a id=fivetwelvea href=https://512kb.club><img id=fivetwelve alt="a proud member of the green team of 512KB club"></a>
<a class=footer-button id=contents href=/blog/contents.html>Contents</a></footer>